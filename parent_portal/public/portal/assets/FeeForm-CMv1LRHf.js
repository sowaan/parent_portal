var j=(t,n,a)=>new Promise((p,h)=>{var g=s=>{try{o(a.next(s))}catch(d){h(d)}},c=s=>{try{o(a.throw(s))}catch(d){h(d)}},o=s=>s.done?p(s.value):Promise.resolve(s.value).then(g,c);o((a=a.apply(t,n)).next())});import{j as e,x as b,p as C,y as w,o as A,M as L,r as u,C as T,d as E,e as I,h as N,k as M,i as f}from"./index-_3kuEyIw.js";import{X as k}from"./index.es-Bx2W2elw.js";import{C as P}from"./CForm-DVCWYhC1.js";var H=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M327.086,496.89l-142.6-142.6-11.258-11.15-85.6-85.6.054-.054,11.259-11.367,85.5-85.5.054.054,142.6-142.595L424,114.989,281.506,257.483,424,399.978ZM184.64,309.3l11.266,11.159,131.18,131.181,51.658-51.658L236.251,257.483,378.744,114.989,327.086,63.331,184.694,205.725l-.054-.054-51.813,51.812Z' class='ci-primary'/>"];const i=({id:t,value:n,lable:a,isDisable:p})=>e.jsxs(e.Fragment,{children:[e.jsx(b,{htmlFor:t,children:a}),e.jsx(C,{type:"text",id:t,placeholder:n,disabled:p})]}),O=[{name:"Fee Category",selector:t=>t.fees_category},{name:"Description",selector:t=>t.description},{name:"Amount",selector:t=>t.amount}],B=()=>{const{slug:t}=w(),n=A(),{data:a,error:p,isValidating:h,mutate:g}=L("Fees",t),[c,o]=u.useState(null),[s,d]=u.useState([]),[v,x]=u.useState(!1),[y,_]=u.useState(""),F=r=>{o(r.target.files[0])},D=r=>j(void 0,null,function*(){if(r.preventDefault(),x(!0),!c){alert("Please select a file to upload.");return}const l=new FormData;l.append("file",c),l.append("is_private",0),l.append("doctype","Fees"),l.append("docname",t);try{yield f.post("/api/method/upload_file",l,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),yield f.put("/api/method/parent_portal.parent_portal.api.set_fee_paid",{fee_id:t}).then(m=>console.log(m)).catch(m=>console.error(m)),o(null),x(!1),_("File uploaded successfully."),setTimeout(()=>{_(""),n("/student-fee")},1e3)}catch(m){console.error("Error during file upload:",m),x(!1),alert("An error occurred. Please try again.")}});function S(){return j(this,null,function*(){try{const l=(yield f.get("/api/method/parent_portal.parent_portal.api.get_fees_attachment",{params:{fee_id:t}})).data.message;d(l)}catch(r){console.error("Failed to fetch attachments:",r.response||r.message)}})}return u.useEffect(()=>{S()},[c]),e.jsx("div",{className:"body flex-grow-1",children:e.jsx(T,{children:e.jsx(E,{xs:12,children:e.jsxs(I,{className:"m-4 mt-0 p-4",children:[e.jsx("div",{className:"badge bg-success p-3 mb-2",children:y}),e.jsxs(P,{className:"row g-12",onSubmit:D,children:[e.jsxs("div",{className:"d-flex align-items-center text-center mb-2",children:[e.jsx(N,{onClick:()=>n(-1),className:"border",children:e.jsx(M,{icon:H})}),e.jsx("div",{className:"m-2",children:t})]}),e.jsxs("div",{className:"mb-3 col-6",children:[e.jsx(b,{htmlFor:"formFile",children:"Attach"}),e.jsx(C,{type:"file",id:"formFile",required:!0,onChange:F,disabled:a&&a.parent_attachment})]}),e.jsx("div",{className:"mb-3 col-6 text-end",children:e.jsx(N,{color:"primary",type:"submit",disabled:v||a&&a.parent_attachment,children:v?"Loading ...":"Submit"})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"student_name",value:a?a.student_name:"",lable:"Student Name",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"institution",value:a?a.company:"",lable:"Institution",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"date",value:a?a.posting_date:"",lable:"Date",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"due_date",value:a?a.due_date:"",lable:"Due Date",isDisable:!0})}),e.jsx("div",{className:"mb-2 col-12",children:a&&a.components.length>0?e.jsx(k,{columns:O,data:a.components,pagination:!0,highlightOnHover:!0,pointerOnHover:!0}):"No data found"}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"total_tax",value:a?a.total_taxes_and_charges:"",lable:"Total Taxes and Charges",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(i,{id:"grand_total",value:a?a.grand_total:"",lable:"Grand Total",isDisable:!0})}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3 col-6",children:[e.jsx(b,{children:"Attachments"}),s&&s.length>0?s.map((r,l)=>e.jsx("div",{children:e.jsx("a",{href:r.file_url,target:"_blank",rel:"noreferrer",children:r.name})},l)):e.jsx("div",{children:"No attachments found."})]})]})]})})})})};export{B as default};
