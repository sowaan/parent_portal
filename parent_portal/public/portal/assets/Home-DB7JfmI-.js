var P=(e,r,s)=>new Promise((i,l)=>{var d=u=>{try{m(s.next(u))}catch(p){l(p)}},h=u=>{try{m(s.throw(u))}catch(p){l(p)}},m=u=>u.done?i(u.value):Promise.resolve(u.value).then(d,h);m((s=s.apply(e,r)).next())});import{r as a,_ as C,t as c,a as y,c as N,P as t,u as ie,T as ce,l as te,m as de,n as me,o as ue,j as o,p as fe,h as z,i as V}from"./index-_3kuEyIw.js";import{X as pe}from"./index.es-Bx2W2elw.js";import{h as T}from"./moment-DFa0WlA5.js";import{C as ve}from"./CForm-DVCWYhC1.js";var A=a.forwardRef(function(e,r){var s=e.children,i=e.className,l=C(e,["children","className"]);return c.createElement("div",y({className:N("modal-content",i)},l,{ref:r}),s)});A.propTypes={children:t.node,className:t.string};A.displayName="CModalContent";var H=a.forwardRef(function(e,r){var s,i=e.children,l=e.alignment,d=e.className,h=e.fullscreen,m=e.scrollable,u=e.size,p=C(e,["children","alignment","className","fullscreen","scrollable","size"]);return c.createElement("div",y({className:N("modal-dialog",(s={"modal-dialog-centered":l==="center"},s[typeof h=="boolean"?"modal-fullscreen":"modal-fullscreen-".concat(h,"-down")]=h,s["modal-dialog-scrollable"]=m,s["modal-".concat(u)]=u,s),d)},p,{ref:r}),i)});H.propTypes={alignment:t.oneOf(["top","center"]),children:t.node,className:t.string,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),scrollable:t.bool,size:t.oneOf(["sm","lg","xl"])};H.displayName="CModalDialog";var ne=a.createContext({}),I=a.forwardRef(function(e,r){var s=e.children,i=e.alignment,l=e.backdrop,d=l===void 0?!0:l,h=e.className,m=e.container,u=e.duration,p=u===void 0?150:u,x=e.focus,M=x===void 0?!0:x,F=e.fullscreen,E=e.keyboard,j=E===void 0?!0:E,w=e.onClose,S=e.onClosePrevented,L=e.onShow,k=e.portal,O=k===void 0?!0:k,n=e.scrollable,v=e.size,b=e.transition,B=b===void 0?!0:b,U=e.unmountOnClose,ae=U===void 0?!0:U,D=e.visible,oe=C(e,["children","alignment","backdrop","className","container","duration","focus","fullscreen","keyboard","onClose","onClosePrevented","onShow","portal","scrollable","size","transition","unmountOnClose","visible"]),$=a.useRef(null),R=a.useRef(null),se=a.useRef(null),le=ie(r,R),G=a.useState(D),g=G[0],_=G[1],J=a.useState(!1),Q=J[0],W=J[1],re={visible:g,setVisible:_};a.useEffect(function(){_(D)},[D]),a.useEffect(function(){var f;return g?($.current=document.activeElement,document.addEventListener("mouseup",Z),document.addEventListener("keydown",ee)):(f=$.current)===null||f===void 0||f.focus(),function(){document.removeEventListener("mouseup",Z),document.removeEventListener("keydown",ee)}},[g]);var Y=function(){return d==="static"?W(!0):(_(!1),w&&w())};a.useLayoutEffect(function(){S&&S(),setTimeout(function(){return W(!1)},p)},[Q]),a.useLayoutEffect(function(){return g?(document.body.classList.add("modal-open"),d&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"),setTimeout(function(){var f;M&&((f=R.current)===null||f===void 0||f.focus())},B?p:0)):(document.body.classList.remove("modal-open"),d&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))),function(){document.body.classList.remove("modal-open"),d&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))}},[g]);var Z=function(f){R.current&&R.current==f.target&&Y()},ee=function(f){f.key==="Escape"&&j&&Y()};return c.createElement(c.Fragment,null,c.createElement(ce,{in:g,mountOnEnter:!0,nodeRef:R,onEnter:L,onExit:w,unmountOnExit:ae,timeout:B?p:0},function(f){return c.createElement(te,{container:m,portal:O},c.createElement(ne.Provider,{value:re},c.createElement("div",y({className:N("modal",{"modal-static":Q,fade:B,show:f==="entered"},h),tabIndex:-1},g?{"aria-modal":!0,role:"dialog"}:{"aria-hidden":"true"},{style:y({},f!=="exited"&&{display:"block"})},oe,{ref:le}),c.createElement(H,{alignment:i,fullscreen:F,scrollable:n,size:v},c.createElement(A,{ref:se},s)))))}),d&&c.createElement(te,{container:m,portal:O},c.createElement(de,{visible:g})))});I.propTypes={alignment:t.oneOf(["top","center"]),backdrop:t.oneOfType([t.bool,t.oneOf(["static"])]),children:t.node,className:t.string,container:t.any,duration:t.number,focus:t.bool,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),keyboard:t.bool,onClose:t.func,onClosePrevented:t.func,onShow:t.func,portal:t.bool,scrollable:t.bool,size:t.oneOf(["sm","lg","xl"]),transition:t.bool,unmountOnClose:t.bool,visible:t.bool};I.displayName="CModal";var X=a.forwardRef(function(e,r){var s=e.children,i=e.className,l=C(e,["children","className"]);return c.createElement("div",y({className:N("modal-body",i)},l,{ref:r}),s)});X.propTypes={children:t.node,className:t.string};X.displayName="CModalBody";var q=a.forwardRef(function(e,r){var s=e.children,i=e.className,l=C(e,["children","className"]);return c.createElement("div",y({className:N("modal-footer",i)},l,{ref:r}),s)});q.propTypes={children:t.node,className:t.string};q.displayName="CModalFooter";var K=a.forwardRef(function(e,r){var s=e.children,i=e.className,l=e.closeButton,d=l===void 0?!0:l,h=C(e,["children","className","closeButton"]),m=a.useContext(ne).setVisible;return c.createElement("div",y({className:N("modal-header",i)},h,{ref:r}),s,d&&c.createElement(me,{onClick:function(){return m(!1)}}))});K.propTypes={children:t.node,className:t.string,closeButton:t.bool};K.displayName="CModalHeader";const Ne=()=>{const e=ue(),[r,s]=a.useState([]),[i,l]=a.useState(!1),[d,h]=a.useState(!1),[m,u]=a.useState([]),[p,x]=a.useState(null),[M,F]=a.useState(!0),[E,j]=a.useState(!1);function w(){return P(this,null,function*(){const n=yield V.get("/api/method/parent_portal.parent_portal.api.get_fee_list",{headers:{"Content-Type":"application/json"}});u(n.data.message),F(!1)})}const S=a.useMemo(()=>[{name:"Student Name",selector:n=>o.jsx("div",{onClick:()=>{e(`/student-fee/${n.name}`)},children:n.student_name})},{name:"Date",selector:n=>n.posting_date,sortable:!0},{name:"Program",selector:n=>n.program},{name:"Family Code",selector:n=>n.family_code},{name:"Total",selector:n=>n.grand_total},{name:"Fee Status",selector:n=>o.jsx("div",{children:n.is_return==1?o.jsx("span",{className:"badge bg-secondary",children:"Refund"}):n.outstanding_amount==0?o.jsx("span",{className:"badge bg-success",children:"Paid"}):n.outstanding_amount>0&&T(n.due_date).isSameOrAfter(T(),"day")?o.jsx("span",{className:"badge bg-warning",children:"Unpaid"}):n.outstanding_amount>0&&T(n.due_date).isBefore(T(),"day")?o.jsx("span",{className:"badge bg-danger",children:"Overdue"}):o.jsx("span",{className:"badge bg-warning",children:"Draft"})})},{name:"Student Status",selector:n=>n.custom_status}],[m]),L=n=>{x(n.target.files[0])},k=a.useCallback(n=>{s(n.selectedRows)},[]),O=a.useMemo(()=>{const n=()=>P(void 0,null,function*(){j(!0);try{if(!p){alert("Please select a file to upload.");return}yield V.post("/api/method/parent_portal.parent_portal.api.make_portal_payment_record",{fees:r}).then(v=>P(void 0,null,function*(){const b=new FormData;b.append("file",p),b.append("is_private",0),b.append("doctype","Portal Payment Record"),b.append("docname",v.data.message.record_name),yield V.post("/api/method/upload_file",b,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})})).catch(v=>console.error(v)),x(null),j(!1),h(!d),l(!1)}catch(v){console.error("Error during file upload:",v),j(!1),alert("An error occurred. Please try again.")}});return o.jsxs("div",{className:"mt-3",children:[o.jsxs(ve,{className:"row g-12",onSubmit:v=>{v.preventDefault(),l(!0)},children:[o.jsx("div",{className:"mb-3 col-6",children:o.jsx(fe,{type:"file",id:"formFile",required:!0,onChange:L})}),o.jsx("div",{className:"mb-3 col-6 text-end",children:o.jsx(z,{color:"primary",type:"submit",children:"Submit"})})]}),o.jsxs(I,{visible:i,onClose:()=>l(!1),children:[o.jsx(K,{children:"Confirm Attachments"}),o.jsxs(X,{children:["Please confirm payment slip attachments for the following fees:",o.jsx("ul",{children:r.map(v=>o.jsx("li",{children:v.name},v.name))})]}),o.jsxs(q,{children:[o.jsx(z,{color:"secondary",onClick:()=>l(!1),children:"Cancel"}),o.jsx(z,{color:"danger",onClick:n,disabled:E,children:E?"attach...":"Confirm"})]})]})]})},[m,r,d,i]);return a.useEffect(()=>{w()},[]),o.jsx(o.Fragment,{children:o.jsx("div",{className:"body m-4 mt-0 p-2 bg-white pt-0 rounded",children:o.jsx(pe,{title:"Fee List",columns:S,data:m.length>0?m:[],progressPending:M,pagination:!0,highlightOnHover:!0,pointerOnHover:!0,selectableRows:!0,contextActions:O,onSelectedRowsChange:k,clearSelectedRows:d,selectableRowDisabled:n=>n.parent_attachment===1})})})};export{Ne as default};
