var C=(i,f,l)=>new Promise((j,h)=>{var o=n=>{try{u(l.next(n))}catch(d){h(d)}},r=n=>{try{u(l.throw(n))}catch(d){h(d)}},u=n=>n.done?j(n.value):Promise.resolve(n.value).then(o,r);u((l=l.apply(i,f)).next())});import{y as D,u as F,r as c,M as w,j as e,D as A,E as M,F as k,f as v,o as E,J as P,H as B,e as I,K as L,d as _}from"./index-CEegmSMn.js";import{I as g}from"./Input-D7JGVm6w.js";import{C as T,a as q,b as H,c as R}from"./CModalHeader-DgiXYpST.js";const W=()=>{const{slug:i}=D(),f=F(),[l,j]=c.useState([]),[h,o]=c.useState(!1),[r,u]=c.useState(""),[n,d]=c.useState(null),[V,b]=c.useState(!1),{data:s,error:z,isValidating:J,mutate:K}=w("Batch Task",i),S=t=>{d(t.target.files[0])},N=t=>C(void 0,null,function*(){if(!r){alert("Please select a student to submit the assignment.");return}if(t.preventDefault(),b(!0),!n){alert("Please select a file to upload.");return}const a=new FormData;a.append("file",n),a.append("is_private",0),a.append("optimize",!0),a.append("doctype","Batch Task"),a.append("docname",i);try{const p=(yield _.post("/api/method/upload_file",a,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})).data.message.file_url;yield _.post("/api/method/parent_portal.parent_portal.api.submit_student_assignment",{name:i,student_id:r,file_url:p}),d(null),o(!1),b(!1)}catch(m){console.error("Error during file upload:",m),b(!1),alert("An error occurred. Please try again.")}});function y(){return C(this,null,function*(){try{if(s){const t=yield _.get("/api/method/parent_portal.parent_portal.api.get_student_details");let a=[];const m=t.data.message;for(let p=0;p<m.length;p++)for(let x=0;x<s.students.length;x++)m[p].name===s.students[x].student&&a.push(s.students[x]);j(a)}}catch(t){console.error("Failed to fetch assignments:",t.response||t.message)}})}return c.useEffect(()=>{y()},[s]),e.jsx("div",{className:"body flex-grow-1",children:e.jsx(A,{children:e.jsx(M,{xs:12,children:e.jsxs(k,{className:"m-4 mt-0 p-4",children:[e.jsxs("div",{className:"d-flex align-items-center text-center justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center text-center mb-2",children:[e.jsx(v,{onClick:()=>f(-1),className:"border",children:e.jsx(E,{icon:P})}),e.jsx("div",{className:"m-2",children:i})]}),e.jsx(v,{onClick:()=>o(!0),className:"btn btn-primary",children:"Submit Assignment"})]}),e.jsxs(T,{visible:h,onClose:()=>o(!1),children:[e.jsx(q,{onClose:()=>o(!1),children:e.jsx("strong",{children:"Confirm Submission"})}),e.jsxs(H,{children:[e.jsxs(B,{value:r,onChange:t=>u(t.target.value),className:"mb-3","aria-label":"Large select example",required:!0,children:[e.jsx("option",{value:"",children:"Select Student"}),l&&l.map((t,a)=>e.jsx("option",{value:t.student,children:t.student_name},a))]}),e.jsx(I,{type:"file",id:"attachment",placeholder:"submit assignment",required:!0,onChange:S,disabled:r==""})]}),e.jsx(R,{children:e.jsx(v,{color:"primary",disabled:r=="",onClick:N,children:"Submit"})})]}),e.jsxs("div",{className:"row g-12",children:[e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"student_assignment",value:s?s.student_assignment:"",lable:"Assignment",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"course",value:s?s.course:"",lable:"Course",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"assignment_date",value:s?s.assignment_date:"",lable:"Posting Date",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"due_date",value:s?s.due_date:"",lable:"Due Date",isDisable:!0})}),e.jsxs("div",{className:"col-12",children:[e.jsx(L,{htmlFor:"recourse",children:"Assignment Details"}),e.jsx("iframe",{src:s?s.recourse:"",width:"100%",height:"500",title:"Assignment",id:"recourse"})]})]})]})})})})};export{W as default};
