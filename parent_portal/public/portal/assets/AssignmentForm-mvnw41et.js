var v=(r,p,n)=>new Promise((x,i)=>{var d=l=>{try{o(n.next(l))}catch(g){i(g)}},b=l=>{try{o(n.throw(l))}catch(g){i(g)}},o=l=>l.done?x(l.value):Promise.resolve(l.value).then(d,b);o((n=n.apply(r,p)).next())});import{h as w,u as D,r as c,M as k,j as e,f as y}from"./index-BqFFroKm.js";import{I as h}from"./Input-CWSYP4_R.js";import{B as F}from"./Breadcrumb-CLOHI3Xr.js";import{A}from"./CommonClasses-DWDFnoTg.js";import{S as C}from"./SelectField-C2KTAYRg.js";const L=()=>{const{slug:r}=w();D();const[p,n]=c.useState([]),[x,i]=c.useState(!1),[d,b]=c.useState(""),[o,l]=c.useState(null),[g,j]=c.useState(!1),{data:t,error:P,isValidating:B,mutate:E}=k("Batch Task",r),_=s=>{l(s.target.files[0])},N=s=>v(void 0,null,function*(){if(!d){alert("Please select a student to submit the assignment.");return}if(s.preventDefault(),j(!0),!o){alert("Please select a file to upload.");return}const a=new FormData;a.append("file",o),a.append("is_private",0),a.append("optimize",!0),a.append("doctype","Batch Task"),a.append("docname",r);try{const m=(yield y.post("/api/method/upload_file",a,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})).data.message.file_url;yield y.post("/api/method/parent_portal.parent_portal.api.submit_student_assignment",{name:r,student_id:d,file_url:m}),l(null),i(!1),j(!1)}catch(u){console.error("Error during file upload:",u),j(!1),alert("An error occurred. Please try again.")}});function S(){return v(this,null,function*(){try{if(t){const s=yield y.get("/api/method/parent_portal.parent_portal.api.get_student_details");let a=[];const u=s.data.message;for(let m=0;m<u.length;m++)for(let f=0;f<t.students.length;f++)u[m].name===t.students[f].student&&a.push(t.students[f]);n(a)}}catch(s){console.error("Failed to fetch assignments:",s.response||s.message)}})}return c.useEffect(()=>{S()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(F,{parent:"assignment",pageName:r}),e.jsx("div",{className:"rounded-xl border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:e.jsxs("div",{className:"m-4 mt-0 p-4",children:[!x&&e.jsx("button",{onClick:()=>i(!0),className:"py-2 px-4 bg-gray rounded-xl text-center font-medium text-primary ",children:"Submit Assignment"}),x&&e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row  items-end",children:[e.jsx("div",{className:"w-full",children:e.jsx(C,{label:"Student",selectedOption:d,onChange:s=>b(s.target.value),required:!0,options:e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Select Student"}),p&&p.map((s,a)=>e.jsx("option",{value:s.student,children:s.student_name},a))]})})}),e.jsx("div",{className:"w-full",children:e.jsx("input",{className:`${A} w-full`,type:"file",id:"attachment",placeholder:"submit assignment",required:!0,onChange:_,disabled:d==""})})]}),e.jsx("button",{onClick:()=>i(!1),className:"inline-flex mr-4 items-center justify-center gap-2.5 rounded-xl bg-gray py-2 px-10 text-center font-medium text-black hover:bg-opacity-90 lg:px-8 xl:px-10",children:"Cancel"}),e.jsx("button",{type:"submit",className:"inline-flex items-center justify-center gap-2.5 rounded-xl bg-primary py-2 px-10 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-10",children:"Submit"}),e.jsx("hr",{className:"my-5.5"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 xl:grid-cols-2 xxl:grid-cols-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{id:"student_assignment",value:t?t.student_assignment:"",lable:"Assignment",isDisable:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(h,{id:"course",value:t?t.course:"",lable:"Course",isDisable:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(h,{id:"assignment_date",value:t?t.assignment_date:"",lable:"Posting Date",isDisable:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(h,{id:"due_date",value:t?t.due_date:"",lable:"Due Date",isDisable:!0})})]}),e.jsx("hr",{className:"my-5.5"}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"recourse",children:"Assignment Details"}),e.jsx("iframe",{src:t?t.recourse:"",width:"100%",height:"500",title:"Assignment",id:"recourse"})]})]})})]})};export{L as default};
