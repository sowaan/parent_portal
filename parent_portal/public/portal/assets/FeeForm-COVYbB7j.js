var D=Object.defineProperty,I=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var w=(t,a,s)=>a in t?D(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,y=(t,a)=>{for(var s in a||(a={}))V.call(a,s)&&w(t,s,a[s]);if(g)for(var s of g(a))E.call(a,s)&&w(t,s,a[s]);return t},F=(t,a)=>I(t,T(a));var f=(t,a,s)=>new Promise((h,u)=>{var _=m=>{try{d(s.next(m))}catch(x){u(x)}},b=m=>{try{d(s.throw(m))}catch(x){u(x)}},d=m=>m.done?h(m.value):Promise.resolve(m.value).then(_,b);d((s=s.apply(t,a)).next())});import{h as M,M as B,r as o,j as e,i as H,f as N}from"./index-DsA6pnSQ.js";import{X as P}from"./index.es-dO0g0hZ-.js";import{B as L}from"./Breadcrumb-D0lrfaOk.js";import{A as O,a as i,I as R}from"./CommonClasses-DWDFnoTg.js";const X=[{name:"Fee Category",selector:t=>t.fees_category},{name:"Description",selector:t=>t.description},{name:"Amount",selector:t=>t.amount}],J=()=>{const{slug:t}=M(),{data:a}=B("Fees",t),[s,h]=o.useState(null),[u,_]=o.useState([]),[b,d]=o.useState(!1),[m,x]=o.useState(""),[j,k]=o.useState(""),[l,v]=o.useState({bank_name:"",transaction_number:"",holder_name:"",mobile_number:""}),p=n=>{const{name:r,value:c}=n.target;v(q=>F(y({},q),{[r]:c}))},C=n=>{h(n.target.files[0])},S=n=>f(void 0,null,function*(){n.preventDefault(),d(!0);try{if(!s)throw"Please select a file to upload.";if(l.bank_name==="")throw"Bank Name is required.";if(l.transaction_number==="")throw"Transaction Number is required.";if(l.holder_name==="")throw"Account Holder Name is required.";if(l.mobile_number==="")throw"Mobile Number is required.";yield N.post("/api/method/parent_portal.parent_portal.api.make_portal_payment_record",{fees:[a],bank_name:l.bank_name,tran_number:l.transaction_number,holder_name:l.holder_name,number:l.mobile_number}).then(r=>f(void 0,null,function*(){const c=new FormData;c.append("file",s),c.append("is_private",0),c.append("doctype","Portal Payment Record"),c.append("docname",r.data.message.record_name),yield N.post("/api/method/upload_file",c,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})})).catch(r=>k(r.response.data.message)),h(null),d(!1),v({bank_name:"",transaction_number:"",holder_name:"",mobile_number:""}),x("File uploaded successfully."),setTimeout(()=>{x(""),navigator("/student-fee")},2e3)}catch(r){k("Error during file upload:",r),d(!1)}});function A(){return f(this,null,function*(){try{const r=(yield N.get("/api/method/parent_portal.parent_portal.api.get_fees_attachment",{params:{fee_id:t}})).data.message;_(r)}catch(n){console.error("Failed to fetch attachments:",n.response||n.message)}})}return o.useEffect(()=>{A()},[s]),e.jsxs(e.Fragment,{children:[e.jsx(L,{parent:"student-fee",pageName:t}),e.jsx("div",{className:"col-span-5 xl:col-span-3",children:e.jsxs("div",{className:"rounded-xl border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e.jsx("div",{className:"border-b border-stroke py-4 px-7 dark:border-strokedark",children:e.jsx("h3",{className:"font-medium text-black dark:text-white",children:"Fee Information"})}),e.jsxs("div",{className:"p-7",children:[m&&e.jsx("div",{className:"badge bg-success bg-opacity-10 text-success p-3 mb-2",children:m}),j&&e.jsx("div",{className:"badge bg-red-300 text-red p-3 mb-2",children:j}),e.jsxs("form",{onSubmit:S,children:[a&&a.parent_attachment?null:e.jsxs("div",{className:"mb-5.5 flex flex-col items-end justify-between gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-black dark:text-white",children:"Attach file"}),e.jsx("input",{type:"file",required:!0,onChange:C,disabled:a&&a.parent_attachment,className:`${O} w-full`})]}),e.jsx("button",{type:"submit",className:"flex cursor-pointer justify-center rounded bg-primary py-2 px-6 font-medium text-gray hover:bg-opacity-90",disabled:b||a&&a.parent_attachment,children:b?"Loading ...":"Submit"})]}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"bank_name",children:"Bank Name"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"bank_name",id:"bank_name",disabled:a&&a.parent_attachment,value:a?a.custom_bank_name:l.bank_name,onChange:p,required:!0})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"transaction_number",children:"Transaction Number"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"transaction_number",id:"transaction_number",disabled:a&&a.parent_attachment,value:a?a.custom_transaction_number:l.transaction_number,onChange:p,required:!0})})]})]}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"holder_name",children:"Account Holder Name"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"holder_name",id:"holder_name",disabled:a&&a.parent_attachment,value:a?a.custom_account_holder_name:l.holder_name,onChange:p,required:!0})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"mobile_number",children:"Mobile Number"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"phone",name:"mobile_number",id:"mobile_number",disabled:a&&a.parent_attachment,value:a?a.custom_mobile_number:l.mobile_number,onChange:p,required:!0})})]})]}),e.jsx("hr",{className:"mb-4"}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"studentName",children:"Student Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4.5 top-4",children:e.jsx(H,{className:"fill-current"})}),e.jsx("input",{className:R,type:"text",name:"studentName",id:"studentName",disabled:!0,defaultValue:a?a.student_name?a.student_name:a.student:""})]})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"institution",children:"Institution"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"institution",id:"institution",disabled:!0,defaultValue:a?a.company:""})})]})]}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"date",children:"Date"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"date",id:"date",disabled:!0,defaultValue:a?a.posting_date:""})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"due_date",children:"Due Date"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"due_date",id:"due_date",disabled:!0,defaultValue:a?a.due_date:""})})]})]}),e.jsx("div",{className:"mb-2 col-12",children:a&&a.components.length>0?e.jsx(P,{columns:X,data:a.components,pagination:!0,highlightOnHover:!0,pointerOnHover:!0}):"No data found"}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"total_tax",children:"Total Taxes and Charges"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"total_tax",id:"total_tax",disabled:!0,defaultValue:a?a.total_taxes_and_charges:""})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"grand_total",children:"Grand Total"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:i,type:"text",name:"grand_total",id:"grand_total",disabled:!0,defaultValue:a?a.grand_total:""})})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3 col-6",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",children:"Attachments"}),u&&u.length>0?u.map((n,r)=>e.jsx("div",{children:e.jsx("a",{href:n.file_url,target:"_blank",rel:"noreferrer",children:n.name})},r)):e.jsx("div",{children:"No attachments found."})]})]})]})]})})]})};export{J as default};
