var j=(r,i,n)=>new Promise((d,s)=>{var l=o=>{try{a(n.next(o))}catch(f){s(f)}},c=o=>{try{a(n.throw(o))}catch(f){s(f)}},a=o=>o.done?d(o.value):Promise.resolve(o.value).then(l,c);a((n=n.apply(r,i)).next())});import{r as u,_,R as T,a as F,c as O,P as t,e as S,j as e,f as Y,u as K,M,b as N}from"./index-DN1Ilg8H.js";import{A as q,c as G,X as V}from"./AppHeader-C_eNUdlI.js";import{b as C,a as B,C as $}from"./CFormInput-CKE0G9Of.js";import{C as z}from"./sowaan-BZG4R8fw.js";var D=u.forwardRef(function(r,i){var n,d=r.children,s=r.className,l=r.color,c=r.textBgColor,a=r.textColor,o=_(r,["children","className","color","textBgColor","textColor"]);return T.createElement("div",F({className:O("card",(n={},n["bg-".concat(l)]=l,n["text-".concat(a)]=a,n["text-bg-".concat(c)]=c,n),s)},o,{ref:i}),d)});D.propTypes={children:t.node,className:t.string,color:S,textBgColor:S,textColor:t.string};D.displayName="CCard";var J=["xxl","xl","lg","md","sm","xs"],w=u.forwardRef(function(r,i){var n=r.children,d=r.className,s=_(r,["children","className"]),l=[];return J.forEach(function(c){var a=s[c];delete s[c];var o=c==="xs"?"":"-".concat(c);(typeof a=="number"||typeof a=="string")&&l.push("col".concat(o,"-").concat(a)),typeof a=="boolean"&&l.push("col".concat(o)),a&&typeof a=="object"&&((typeof a.span=="number"||typeof a.span=="string")&&l.push("col".concat(o,"-").concat(a.span)),typeof a.span=="boolean"&&l.push("col".concat(o)),(typeof a.order=="number"||typeof a.order=="string")&&l.push("order".concat(o,"-").concat(a.order)),typeof a.offset=="number"&&l.push("offset".concat(o,"-").concat(a.offset)))}),T.createElement("div",F({className:O(l.length>0?l:"col",d)},s,{ref:i}),n)}),P=t.oneOfType([t.bool,t.number,t.string,t.oneOf(["auto"])]),h=t.oneOfType([P,t.shape({span:P,offset:t.oneOfType([t.number,t.string]),order:t.oneOfType([t.oneOf(["first","last"]),t.number,t.string])})]);w.propTypes={children:t.node,className:t.string,xs:h,sm:h,md:h,lg:h,xl:h,xxl:h};w.displayName="CCol";var Q=["xxl","xl","lg","md","sm","xs"],A=u.forwardRef(function(r,i){var n=r.children,d=r.className,s=_(r,["children","className"]),l=[];return Q.forEach(function(c){var a=s[c];delete s[c];var o=c==="xs"?"":"-".concat(c);typeof a=="object"&&(a.cols&&l.push("row-cols".concat(o,"-").concat(a.cols)),typeof a.gutter=="number"&&l.push("g".concat(o,"-").concat(a.gutter)),typeof a.gutterX=="number"&&l.push("gx".concat(o,"-").concat(a.gutterX)),typeof a.gutterY=="number"&&l.push("gy".concat(o,"-").concat(a.gutterY)))}),T.createElement("div",F({className:O("row",l,d)},s,{ref:i}),n)}),x=t.shape({cols:t.oneOfType([t.oneOf(["auto"]),t.number,t.string]),gutter:t.oneOfType([t.string,t.number]),gutterX:t.oneOfType([t.string,t.number]),gutterY:t.oneOfType([t.string,t.number])});A.propTypes={children:t.node,className:t.string,xs:x,sm:x,md:x,lg:x,xl:x,xxl:x};A.displayName="CRow";const g=({id:r,value:i,lable:n,isDisable:d})=>e.jsxs(e.Fragment,{children:[e.jsx(C,{htmlFor:r,children:n}),e.jsx(B,{type:"text",id:r,placeholder:i,disabled:d})]}),U=[{name:"Fee Category",selector:r=>r.fees_category},{name:"Description",selector:r=>r.description},{name:"Amount",selector:r=>r.amount}],se=({sidebarShow:r,setSidebarShow:i})=>{const{slug:n}=Y(),d=K(),{data:s,error:l,isValidating:c,mutate:a}=M("Fees",n),[o,f]=u.useState(null),[v,I]=u.useState([]),[E,y]=u.useState(!1),[X,R]=u.useState(""),k=m=>{f(m.target.files[0])},H=m=>j(void 0,null,function*(){if(m.preventDefault(),y(!0),!o){alert("Please select a file to upload.");return}const p=new FormData;p.append("file",o),p.append("is_private",0),p.append("doctype","Fees"),p.append("docname",n);try{yield N.post("/api/method/upload_file",p,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}}),yield N.put("/api/method/parent_portal.parent_portal.api.set_fee_paid",{fee_id:n}).then(b=>console.log(b)).catch(b=>console.error(b)),f(null),y(!1),R("File uploaded successfully."),setTimeout(()=>{R(""),d("/student-fee")},1e3)}catch(b){console.error("Error during file upload:",b),y(!1),alert("An error occurred. Please try again.")}});function L(){return j(this,null,function*(){try{const p=(yield N.get("/api/method/parent_portal.parent_portal.api.get_fees_attachment",{params:{fee_id:n}})).data.message;I(p)}catch(m){console.error("Failed to fetch attachments:",m.response||m.message)}})}return u.useEffect(()=>{L()},[o]),e.jsxs("div",{children:[e.jsx(q,{sidebarShow:r,setSidebarShow:i}),e.jsxs("div",{className:"wrapper d-flex flex-column min-vh-100",children:[e.jsx(G,{sidebarShow:r,setSidebarShow:i}),e.jsx("div",{className:"body flex-grow-1",children:e.jsx(A,{children:e.jsx(w,{xs:12,children:e.jsxs(D,{className:"m-4 mt-0 p-4",children:[e.jsx("div",{className:"badge bg-success p-3 mb-2",children:X}),e.jsxs($,{className:"row g-12",onSubmit:H,children:[e.jsxs("div",{className:"mb-3 col-6",children:[e.jsx(C,{htmlFor:"formFile",children:"Attach"}),e.jsx(B,{type:"file",id:"formFile",required:!0,onChange:k,disabled:s&&s.parent_attachment})]}),e.jsx("div",{className:"mb-3 col-6 text-end",children:e.jsx(z,{color:"primary",type:"submit",disabled:E||s&&s.parent_attachment,children:E?"Loading ...":"Submit"})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"student_name",value:s?s.student_name:"",lable:"Student Name",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"institution",value:s?s.company:"",lable:"Institution",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"date",value:s?s.posting_date:"",lable:"Date",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"due_date",value:s?s.due_date:"",lable:"Due Date",isDisable:!0})}),e.jsx("div",{className:"mb-2 col-12",children:s&&s.components.length>0?e.jsx(V,{columns:U,data:s.components,pagination:!0,highlightOnHover:!0,pointerOnHover:!0}):"No data found"}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"total_tax",value:s?s.total_taxes_and_charges:"",lable:"Total Taxes and Charges",isDisable:!0})}),e.jsx("div",{className:"mb-3 col-6",children:e.jsx(g,{id:"grand_total",value:s?s.grand_total:"",lable:"Grand Total",isDisable:!0})}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3 col-6",children:[e.jsx(C,{children:"Attachments"}),v&&v.length>0?v.map((m,p)=>e.jsx("div",{children:e.jsx("a",{href:m.file_url,target:"_blank",rel:"noreferrer",children:m.name})},p)):e.jsx("div",{children:"No attachments found."})]})]})]})})})})]})]})};export{se as default};
