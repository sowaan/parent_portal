var B=Object.defineProperty,E=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var C=(r,t,s)=>t in r?B(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,S=(r,t)=>{for(var s in t||(t={}))$.call(t,s)&&C(r,s,t[s]);if(w)for(var s of w(t))I.call(t,s)&&C(r,s,t[s]);return r},F=(r,t)=>E(r,L(t));var N=(r,t,s)=>new Promise((m,c)=>{var h=i=>{try{u(s.next(i))}catch(b){c(b)}},g=i=>{try{u(s.throw(i))}catch(b){c(b)}},u=i=>i.done?m(i.value):Promise.resolve(i.value).then(h,g);u((s=s.apply(r,t)).next())});import{j as e,u as J,F as U,r as l,f as R}from"./index-DsA6pnSQ.js";import{J as W,X}from"./index.es-dO0g0hZ-.js";import{h as o}from"./moment-DFa0WlA5.js";import{T as d,C as z,a as f}from"./CommonClasses-DWDFnoTg.js";function V({isModalVisible:r,setIsModalVisible:t,body:s,handleSubmit:m,agree:c}){return e.jsx(e.Fragment,{children:r&&e.jsx("div",{className:"inset-0 flex items-center justify-center z-50 h-screen","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg w-[100vw]",children:[e.jsxs("div",{className:"px-6 py-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Confirm Attachments"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",onClick:()=>t(!1),children:"âœ•"})]}),s,e.jsxs("div",{className:"px-6 py-3 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-gray-700 dark:text-white bg-gray-200 dark:bg-gray-600 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition",onClick:()=>t(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 transition disabled:opacity-50",onClick:m,disabled:c,children:c?"Wait...":"Confirm"})]})]})})})}W("default",{background:{default:"transparent"}});const ee=()=>{const r=J(),{data:t,isLoading:s}=U("parent_portal.parent_portal.api.get_fee_list"),[m,c]=l.useState([]),[h,g]=l.useState(!1),[u,i]=l.useState(!1),[b,y]=l.useState(null),[q,_]=l.useState(!1),[v,j]=l.useState(""),[n,k]=l.useState({bank_name:"",transaction_number:"",holder_name:"",mobile_number:""}),p=a=>{const{name:x,value:H}=a.target;k(O=>F(S({},O),{[x]:H}))},D=l.useMemo(()=>[{name:e.jsx("div",{className:d,children:"Student Name"}),selector:a=>e.jsx("div",{className:d,onClick:()=>{r(`/student-fee/${a.name}`)},children:a.student_name})},{name:e.jsx("div",{className:d,children:"Date"}),selector:a=>e.jsx("p",{className:"text-black dark:text-white",children:a.posting_date}),sortable:!0},{name:e.jsx("div",{className:d,children:"Program"}),selector:a=>e.jsx("p",{className:"text-black dark:text-white",children:a.program})},{name:e.jsx("div",{className:d,children:"Family Code"}),selector:a=>e.jsx("p",{className:"text-black dark:text-white",children:a.family_code})},{name:e.jsx("div",{className:d,children:"Total"}),selector:a=>e.jsx("p",{className:"text-black dark:text-white",children:parseFloat(parseFloat(a.grand_total.toString()).toFixed(2))})},{name:e.jsx("div",{className:d,children:"Fee Status"}),selector:a=>e.jsx("div",{className:`inline-flex rounded-full bg-opacity-10 py-1 px-3 text-sm font-medium ${a.is_return==1?"bg-secondary text-secondary":a.outstanding_amount==0?"bg-success text-success":a.outstanding_amount>0&&o(a.due_date).isSameOrAfter(o(),"day")?"bg-warning text-warning":a.outstanding_amount>0&&o(a.due_date).isBefore(o(),"day")?"bg-danger text-danger":"bg-warning text-warning"}`,children:a.is_return==1?"Refund":a.outstanding_amount==0?"Paid":a.outstanding_amount>0&&o(a.due_date).isSameOrAfter(o(),"day")?"Unpaid":a.outstanding_amount>0&&o(a.due_date).isBefore(o(),"day")?"Overdue":"Draft"})},{name:e.jsx("div",{className:d,children:"Student Status"}),selector:a=>e.jsx("p",{className:`inline-flex rounded-full bg-opacity-10 py-1 px-3 text-sm font-medium ${a.custom_status==="Active"?"bg-success text-success":"bg-danger text-danger"}`,children:a.custom_status})}],[t]),A=a=>{y(a.target.files[0])},P=l.useCallback(a=>{c(a.selectedRows)},[]),T=()=>N(void 0,null,function*(){_(!0);try{if(!b)throw"Please select a file to upload.";if(n.bank_name==="")throw"Bank Name is required.";if(n.transaction_number==="")throw"Transaction Number is required.";if(n.holder_name==="")throw"Account Holder Name is required.";if(n.mobile_number==="")throw"Mobile Number is required.";yield R.post("/api/method/parent_portal.parent_portal.api.make_portal_payment_record",{fees:m,bank_name:n.bank_name,tran_number:n.transaction_number,holder_name:n.holder_name,number:n.mobile_number}).then(a=>N(void 0,null,function*(){const x=new FormData;x.append("file",b),x.append("is_private",0),x.append("doctype","Portal Payment Record"),x.append("docname",a.data.message.record_name),yield R.post("/api/method/upload_file",x,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})})).catch(a=>j(a.response.data.message)),y(null),_(!1),k({bank_name:"",transaction_number:"",holder_name:"",mobile_number:""}),j(""),i(!u),g(!1)}catch(a){j("Error during file upload:",a),_(!1)}}),M=l.useMemo(()=>e.jsx("div",{className:"mt-3",children:e.jsxs("form",{className:"grid grid-cols-2 gap-6",onSubmit:a=>{a.preventDefault(),g(!0)},children:[e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"file",id:"formFile",required:!0,onChange:A,className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none dark:text-white dark:border-gray-600 dark:bg-gray-800"})}),e.jsx("div",{className:"mb-3 flex justify-end",children:e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Submit"})})]})}),[t,m,u,h]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:z,children:[v&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:v}),h?e.jsx(V,{isModalVisible:h,setIsModalVisible:g,body:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Please confirm payment slip attachments for the following fees:"}),e.jsx("ul",{className:"mt-2 space-y-1 text-gray-900 dark:text-white",children:m.map(a=>e.jsx("li",{className:"list-disc ml-5",children:a.name},a.name))}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"bank_name",children:"Bank Name"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:f,type:"text",name:"bank_name",id:"bank_name",value:n.bank_name,onChange:p,required:!0})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"transaction_number",children:"Transaction Number"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:f,type:"text",name:"transaction_number",id:"transaction_number",value:n.transaction_number,onChange:p,required:!0})})]})]}),e.jsxs("div",{className:"mb-5.5 flex flex-col gap-5.5 sm:flex-row",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"holder_name",children:"Account Holder Name"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:f,type:"text",name:"holder_name",id:"holder_name",value:n.holder_name,onChange:p,required:!0})})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-black dark:text-white",htmlFor:"mobile_number",children:"Mobile Number"}),e.jsx("div",{className:"relative",children:e.jsx("input",{className:f,type:"phone",name:"mobile_number",id:"mobile_number",value:n.mobile_number,onChange:p,required:!0})})]})]})]}),handleSubmit:T,agree:q}):e.jsx(X,{title:e.jsx("h2",{className:d,children:"Fees"}),columns:D,data:t?t.message:[],progressPending:s,pagination:!0,highlightOnHover:!0,pointerOnHover:!0,selectableRows:!0,contextActions:M,onSelectedRowsChange:P,clearSelectedRows:u,selectableRowDisabled:a=>a.parent_attachment===1,theme:"default"})]})})};export{ee as default};
