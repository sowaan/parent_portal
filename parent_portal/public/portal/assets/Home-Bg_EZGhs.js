var T=(e,i,a)=>new Promise((r,s)=>{var m=d=>{try{f(a.next(d))}catch(p){s(p)}},u=d=>{try{f(a.throw(d))}catch(p){s(p)}},f=d=>d.done?r(d.value):Promise.resolve(d.value).then(m,u);f((a=a.apply(e,i)).next())});import{r as o,_ as N,R as c,a as g,c as E,P as t,u as re,j as l,b as A}from"./index-DN1Ilg8H.js";import{u as ie,T as ce,C as ee,a as de,b as me,A as ue,c as fe,X as pe}from"./AppHeader-C_eNUdlI.js";import{C as ve,a as be}from"./CFormInput-CKE0G9Of.js";import{C as H}from"./sowaan-BZG4R8fw.js";var V=o.forwardRef(function(e,i){var a=e.children,r=e.className,s=N(e,["children","className"]);return c.createElement("div",g({className:E("modal-content",r)},s,{ref:i}),a)});V.propTypes={children:t.node,className:t.string};V.displayName="CModalContent";var I=o.forwardRef(function(e,i){var a,r=e.children,s=e.alignment,m=e.className,u=e.fullscreen,f=e.scrollable,d=e.size,p=N(e,["children","alignment","className","fullscreen","scrollable","size"]);return c.createElement("div",g({className:E("modal-dialog",(a={"modal-dialog-centered":s==="center"},a[typeof u=="boolean"?"modal-fullscreen":"modal-fullscreen-".concat(u,"-down")]=u,a["modal-dialog-scrollable"]=f,a["modal-".concat(d)]=d,a),m)},p,{ref:i}),r)});I.propTypes={alignment:t.oneOf(["top","center"]),children:t.node,className:t.string,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),scrollable:t.bool,size:t.oneOf(["sm","lg","xl"])};I.displayName="CModalDialog";var te=o.createContext({}),_=o.forwardRef(function(e,i){var a=e.children,r=e.alignment,s=e.backdrop,m=s===void 0?!0:s,u=e.className,f=e.container,d=e.duration,p=d===void 0?150:d,R=e.focus,j=R===void 0?!0:R,k=e.fullscreen,S=e.keyboard,M=S===void 0?!0:S,C=e.onClose,x=e.onClosePrevented,L=e.onShow,P=e.portal,O=P===void 0?!0:P,F=e.scrollable,B=e.size,n=e.transition,v=n===void 0?!0:n,h=e.unmountOnClose,oe=h===void 0?!0:h,z=e.visible,ne=N(e,["children","alignment","backdrop","className","container","duration","focus","fullscreen","keyboard","onClose","onClosePrevented","onShow","portal","scrollable","size","transition","unmountOnClose","visible"]),Q=o.useRef(null),w=o.useRef(null),ae=o.useRef(null),le=ie(i,w),U=o.useState(z),y=U[0],D=U[1],W=o.useState(!1),Z=W[0],$=W[1],se={visible:y,setVisible:D};o.useEffect(function(){D(z)},[z]),o.useEffect(function(){var b;return y?(Q.current=document.activeElement,document.addEventListener("mouseup",J),document.addEventListener("keydown",Y)):(b=Q.current)===null||b===void 0||b.focus(),function(){document.removeEventListener("mouseup",J),document.removeEventListener("keydown",Y)}},[y]);var G=function(){return m==="static"?$(!0):(D(!1),C&&C())};o.useLayoutEffect(function(){x&&x(),setTimeout(function(){return $(!1)},p)},[Z]),o.useLayoutEffect(function(){return y?(document.body.classList.add("modal-open"),m&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"),setTimeout(function(){var b;j&&((b=w.current)===null||b===void 0||b.focus())},v?p:0)):(document.body.classList.remove("modal-open"),m&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))),function(){document.body.classList.remove("modal-open"),m&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))}},[y]);var J=function(b){w.current&&w.current==b.target&&G()},Y=function(b){b.key==="Escape"&&M&&G()};return c.createElement(c.Fragment,null,c.createElement(ce,{in:y,mountOnEnter:!0,nodeRef:w,onEnter:L,onExit:C,unmountOnExit:oe,timeout:v?p:0},function(b){return c.createElement(ee,{container:f,portal:O},c.createElement(te.Provider,{value:se},c.createElement("div",g({className:E("modal",{"modal-static":Z,fade:v,show:b==="entered"},u),tabIndex:-1},y?{"aria-modal":!0,role:"dialog"}:{"aria-hidden":"true"},{style:g({},b!=="exited"&&{display:"block"})},ne,{ref:le}),c.createElement(I,{alignment:r,fullscreen:k,scrollable:F,size:B},c.createElement(V,{ref:ae},a)))))}),m&&c.createElement(ee,{container:f,portal:O},c.createElement(de,{visible:y})))});_.propTypes={alignment:t.oneOf(["top","center"]),backdrop:t.oneOfType([t.bool,t.oneOf(["static"])]),children:t.node,className:t.string,container:t.any,duration:t.number,focus:t.bool,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),keyboard:t.bool,onClose:t.func,onClosePrevented:t.func,onShow:t.func,portal:t.bool,scrollable:t.bool,size:t.oneOf(["sm","lg","xl"]),transition:t.bool,unmountOnClose:t.bool,visible:t.bool};_.displayName="CModal";var X=o.forwardRef(function(e,i){var a=e.children,r=e.className,s=N(e,["children","className"]);return c.createElement("div",g({className:E("modal-body",r)},s,{ref:i}),a)});X.propTypes={children:t.node,className:t.string};X.displayName="CModalBody";var K=o.forwardRef(function(e,i){var a=e.children,r=e.className,s=N(e,["children","className"]);return c.createElement("div",g({className:E("modal-footer",r)},s,{ref:i}),a)});K.propTypes={children:t.node,className:t.string};K.displayName="CModalFooter";var q=o.forwardRef(function(e,i){var a=e.children,r=e.className,s=e.closeButton,m=s===void 0?!0:s,u=N(e,["children","className","closeButton"]),f=o.useContext(te).setVisible;return c.createElement("div",g({className:E("modal-header",r)},u,{ref:i}),a,m&&c.createElement(me,{onClick:function(){return f(!1)}}))});q.propTypes={children:t.node,className:t.string,closeButton:t.bool};q.displayName="CModalHeader";const Ne=({sidebarShow:e,setSidebarShow:i})=>{const a=re(),[r,s]=o.useState([]),[m,u]=o.useState(!1),[f,d]=o.useState(!1),[p,R]=o.useState([]),[j,k]=o.useState(null),[S,M]=o.useState(!0),[C,x]=o.useState(!1);function L(){return T(this,null,function*(){const n=yield A.get("/api/method/parent_portal.parent_portal.api.get_fee_list",{headers:{"Content-Type":"application/json"}});R(n.data.message),M(!1)})}const P=o.useMemo(()=>[{name:"Id",cell:n=>l.jsx("div",{onClick:()=>{a(`/student-fee/${n.name}`)},className:"sc-fAUdSK sc-dntaoT sc-ivxoEo dLHSn dQcPXM bOmZtP rdt_TableCell",children:l.jsx("div",{children:n.name})}),style:{minWidth:"200px"},button:!0,sortable:!0},{name:"Date",selector:n=>n.posting_date,sortable:!0},{name:"Student Name",selector:n=>n.student_name},{name:"Program",selector:n=>n.program},{name:"Family Code",selector:n=>n.family_code},{name:"Total",selector:n=>n.grand_total}],[p]),O=n=>{k(n.target.files[0])},F=o.useCallback(n=>{s(n.selectedRows)},[]),B=o.useMemo(()=>{const n=()=>T(void 0,null,function*(){x(!0);try{if(!j){alert("Please select a file to upload.");return}yield A.post("/api/method/parent_portal.parent_portal.api.make_portal_payment_record",{fees:r}).then(v=>T(void 0,null,function*(){const h=new FormData;h.append("file",j),h.append("is_private",0),h.append("doctype","Portal Payment Record"),h.append("docname",v.data.message.record_name),yield A.post("/api/method/upload_file",h,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})})).catch(v=>console.error(v)),k(null),x(!1),d(!f),u(!1)}catch(v){console.error("Error during file upload:",v),x(!1),alert("An error occurred. Please try again.")}});return l.jsxs("div",{className:"mt-3",children:[l.jsxs(ve,{className:"row g-12",onSubmit:v=>{v.preventDefault(),u(!0)},children:[l.jsx("div",{className:"mb-3 col-6",children:l.jsx(be,{type:"file",id:"formFile",required:!0,onChange:O})}),l.jsx("div",{className:"mb-3 col-6 text-end",children:l.jsx(H,{color:"primary",type:"submit",children:"Submit"})})]}),l.jsxs(_,{visible:m,onClose:()=>u(!1),children:[l.jsx(q,{children:"Confirm Attachments"}),l.jsxs(X,{children:["Please confirm payment slip attachments for the following fees:",l.jsx("ul",{children:r.map(v=>l.jsx("li",{children:v.name},v.name))})]}),l.jsxs(K,{children:[l.jsx(H,{color:"secondary",onClick:()=>u(!1),children:"Cancel"}),l.jsx(H,{color:"danger",onClick:n,disabled:C,children:C?"attach...":"Confirm"})]})]})]})},[p,r,f,m]);return o.useEffect(()=>{L()},[]),l.jsxs("div",{children:[l.jsx(ue,{sidebarShow:e,setSidebarShow:i}),l.jsxs("div",{className:"wrapper d-flex flex-column min-vh-100",children:[l.jsx(fe,{sidebarShow:e,setSidebarShow:i}),l.jsx("div",{className:"body m-4 mt-0 p-2 bg-white pt-0 rounded",children:l.jsx(pe,{title:"Fee List",columns:P,data:p.length>0?p:[],progressPending:S,pagination:!0,highlightOnHover:!0,pointerOnHover:!0,selectableRows:!0,contextActions:B,onSelectedRowsChange:F,clearSelectedRows:f,selectableRowDisabled:n=>n.parent_attachment===1})})]})]})};export{Ne as default};
