var F=(e,d,n)=>new Promise((u,o)=>{var l=i=>{try{p(n.next(i))}catch(h){o(h)}},r=i=>{try{p(n.throw(i))}catch(h){o(h)}},p=i=>i.done?u(i.value):Promise.resolve(i.value).then(l,r);p((n=n.apply(e,d)).next())});import{r as a,_ as j,q as ne,R as c,T as ae,t as x,v as E,P as t,C as se,w as ue,h as me,u as fe,M as pe,j as s,f as z}from"./index-DHC1J-Z3.js";import{C as ve}from"./index.esm-CSKFpvZb.js";import{I as T}from"./Input-C8JaFpsh.js";import{C as be,a as he}from"./CRow-CS0UGAKT.js";import{C as ge}from"./CCard-Ctp6_UM5.js";import{C as A}from"./CButton-DdvSfOFq.js";import{C as Ce,a as ye}from"./CFormSelect-CilfhOwp.js";import{C as xe}from"./CFormInput-Crel1Lim.js";var V=a.forwardRef(function(e,d){var n=e.className,u=n===void 0?"modal-backdrop":n,o=e.visible,l=j(e,["className","visible"]),r=a.useRef(null),p=ne(d,r);return c.createElement(ae,{in:o,mountOnEnter:!0,nodeRef:r,timeout:150,unmountOnExit:!0},function(i){return c.createElement("div",x({className:E(u,"fade",{show:i==="entered"})},l,{ref:p}))})});V.propTypes={className:t.string,visible:t.bool};V.displayName="CBackdrop";var _=a.forwardRef(function(e,d){var n=e.children,u=e.className,o=j(e,["children","className"]);return c.createElement("div",x({className:E("modal-content",u)},o,{ref:d}),n)});_.propTypes={children:t.node,className:t.string};_.displayName="CModalContent";var I=a.forwardRef(function(e,d){var n,u=e.children,o=e.alignment,l=e.className,r=e.fullscreen,p=e.scrollable,i=e.size,h=j(e,["children","alignment","className","fullscreen","scrollable","size"]);return c.createElement("div",x({className:E("modal-dialog",(n={"modal-dialog-centered":o==="center"},n[typeof r=="boolean"?"modal-fullscreen":"modal-fullscreen-".concat(r,"-down")]=r,n["modal-dialog-scrollable"]=p,n["modal-".concat(i)]=i,n),l)},h,{ref:d}),u)});I.propTypes={alignment:t.oneOf(["top","center"]),children:t.node,className:t.string,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),scrollable:t.bool,size:t.oneOf(["sm","lg","xl"])};I.displayName="CModalDialog";var oe=a.createContext({}),q=a.forwardRef(function(e,d){var n=e.children,u=e.alignment,o=e.backdrop,l=o===void 0?!0:o,r=e.className,p=e.container,i=e.duration,h=i===void 0?150:i,M=e.focus,w=M===void 0?!0:M,m=e.fullscreen,P=e.keyboard,G=P===void 0?!0:P,R=e.onClose,S=e.onClosePrevented,D=e.onShow,O=e.portal,f=O===void 0?!0:O,b=e.scrollable,N=e.size,g=e.transition,C=g===void 0?!0:g,J=e.unmountOnClose,le=J===void 0?!0:J,L=e.visible,re=j(e,["children","alignment","backdrop","className","container","duration","focus","fullscreen","keyboard","onClose","onClosePrevented","onShow","portal","scrollable","size","transition","unmountOnClose","visible"]),Q=a.useRef(null),k=a.useRef(null),ie=a.useRef(null),ce=ne(d,k),U=a.useState(L),y=U[0],B=U[1],W=a.useState(!1),X=W[0],Y=W[1],de={visible:y,setVisible:B};a.useEffect(function(){B(L)},[L]),a.useEffect(function(){var v;return y?(Q.current=document.activeElement,document.addEventListener("mouseup",ee),document.addEventListener("keydown",te)):(v=Q.current)===null||v===void 0||v.focus(),function(){document.removeEventListener("mouseup",ee),document.removeEventListener("keydown",te)}},[y]);var $=function(){return l==="static"?Y(!0):(B(!1),R&&R())};a.useLayoutEffect(function(){S&&S(),setTimeout(function(){return Y(!1)},h)},[X]),a.useLayoutEffect(function(){return y?(document.body.classList.add("modal-open"),l&&(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"),setTimeout(function(){var v;w&&((v=k.current)===null||v===void 0||v.focus())},C?h:0)):(document.body.classList.remove("modal-open"),l&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))),function(){document.body.classList.remove("modal-open"),l&&(document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))}},[y]);var ee=function(v){k.current&&k.current==v.target&&$()},te=function(v){v.key==="Escape"&&G&&$()};return c.createElement(c.Fragment,null,c.createElement(ae,{in:y,mountOnEnter:!0,nodeRef:k,onEnter:D,onExit:R,unmountOnExit:le,timeout:C?h:0},function(v){return c.createElement(se,{container:p,portal:f},c.createElement(oe.Provider,{value:de},c.createElement("div",x({className:E("modal",{"modal-static":X,fade:C,show:v==="entered"},r),tabIndex:-1},y?{"aria-modal":!0,role:"dialog"}:{"aria-hidden":"true"},{style:x({},v!=="exited"&&{display:"block"})},re,{ref:ce}),c.createElement(I,{alignment:u,fullscreen:m,scrollable:b,size:N},c.createElement(_,{ref:ie},n)))))}),l&&c.createElement(se,{container:p,portal:f},c.createElement(V,{visible:y})))});q.propTypes={alignment:t.oneOf(["top","center"]),backdrop:t.oneOfType([t.bool,t.oneOf(["static"])]),children:t.node,className:t.string,container:t.any,duration:t.number,focus:t.bool,fullscreen:t.oneOfType([t.bool,t.oneOf(["sm","md","lg","xl","xxl"])]),keyboard:t.bool,onClose:t.func,onClosePrevented:t.func,onShow:t.func,portal:t.bool,scrollable:t.bool,size:t.oneOf(["sm","lg","xl"]),transition:t.bool,unmountOnClose:t.bool,visible:t.bool};q.displayName="CModal";var H=a.forwardRef(function(e,d){var n=e.children,u=e.className,o=j(e,["children","className"]);return c.createElement("div",x({className:E("modal-body",u)},o,{ref:d}),n)});H.propTypes={children:t.node,className:t.string};H.displayName="CModalBody";var Z=a.forwardRef(function(e,d){var n=e.children,u=e.className,o=j(e,["children","className"]);return c.createElement("div",x({className:E("modal-footer",u)},o,{ref:d}),n)});Z.propTypes={children:t.node,className:t.string};Z.displayName="CModalFooter";var K=a.forwardRef(function(e,d){var n=e.children,u=e.className,o=e.closeButton,l=o===void 0?!0:o,r=j(e,["children","className","closeButton"]),p=a.useContext(oe).setVisible;return c.createElement("div",x({className:E("modal-header",u)},r,{ref:d}),n,l&&c.createElement(ue,{onClick:function(){return p(!1)}}))});K.propTypes={children:t.node,className:t.string,closeButton:t.bool};K.displayName="CModalHeader";var Ne=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M327.086,496.89l-142.6-142.6-11.258-11.15-85.6-85.6.054-.054,11.259-11.367,85.5-85.5.054.054,142.6-142.595L424,114.989,281.506,257.483,424,399.978ZM184.64,309.3l11.266,11.159,131.18,131.181,51.658-51.658L236.251,257.483,378.744,114.989,327.086,63.331,184.694,205.725l-.054-.054-51.813,51.812Z' class='ci-primary'/>"];const Pe=()=>{const{slug:e}=me(),d=fe(),[n,u]=a.useState([]),[o,l]=a.useState(!1),[r,p]=a.useState(""),[i,h]=a.useState(null),[M,w]=a.useState(!1),{data:m,error:P,isValidating:G,mutate:R}=pe("Batch Task",e),S=f=>{h(f.target.files[0])},D=f=>F(void 0,null,function*(){if(!r){alert("Please select a student to submit the assignment.");return}if(f.preventDefault(),w(!0),!i){alert("Please select a file to upload.");return}const b=new FormData;b.append("file",i),b.append("is_private",0),b.append("optimize",!0),b.append("doctype","Batch Task"),b.append("docname",e);try{const g=(yield z.post("/api/method/upload_file",b,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json"}})).data.message.file_url;yield z.post("/api/method/parent_portal.parent_portal.api.submit_student_assignment",{name:e,student_id:r,file_url:g}),h(null),l(!1),w(!1)}catch(N){console.error("Error during file upload:",N),w(!1),alert("An error occurred. Please try again.")}});function O(){return F(this,null,function*(){try{if(m){const f=yield z.get("/api/method/parent_portal.parent_portal.api.get_student_details");let b=[];const N=f.data.message;for(let g=0;g<N.length;g++)for(let C=0;C<m.students.length;C++)N[g].name===m.students[C].student&&b.push(m.students[C]);u(b)}}catch(f){console.error("Failed to fetch assignments:",f.response||f.message)}})}return a.useEffect(()=>{O()},[m]),s.jsx("div",{className:"body flex-grow-1",children:s.jsx(be,{children:s.jsx(he,{xs:12,children:s.jsxs(ge,{className:"m-4 mt-0 p-4",children:[s.jsxs("div",{className:"d-flex align-items-center text-center justify-content-between",children:[s.jsxs("div",{className:"d-flex align-items-center text-center mb-2",children:[s.jsx(A,{onClick:()=>d(-1),className:"border",children:s.jsx(ve,{icon:Ne})}),s.jsx("div",{className:"m-2",children:e})]}),s.jsx(A,{onClick:()=>l(!0),className:"btn btn-primary",children:"Submit Assignment"})]}),s.jsxs(q,{visible:o,onClose:()=>l(!1),children:[s.jsx(K,{onClose:()=>l(!1),children:s.jsx("strong",{children:"Confirm Submission"})}),s.jsxs(H,{children:[s.jsxs(Ce,{value:r,onChange:f=>p(f.target.value),className:"mb-3","aria-label":"Large select example",required:!0,children:[s.jsx("option",{value:"",children:"Select Student"}),n&&n.map((f,b)=>s.jsx("option",{value:f.student,children:f.student_name},b))]}),s.jsx(xe,{type:"file",id:"attachment",placeholder:"submit assignment",required:!0,onChange:S,disabled:r==""})]}),s.jsx(Z,{children:s.jsx(A,{color:"primary",disabled:r=="",onClick:D,children:"Submit"})})]}),s.jsxs("div",{className:"row g-12",children:[s.jsx("div",{className:"mb-3 col-6",children:s.jsx(T,{id:"student_assignment",value:m?m.student_assignment:"",lable:"Assignment",isDisable:!0})}),s.jsx("div",{className:"mb-3 col-6",children:s.jsx(T,{id:"course",value:m?m.course:"",lable:"Course",isDisable:!0})}),s.jsx("div",{className:"mb-3 col-6",children:s.jsx(T,{id:"assignment_date",value:m?m.assignment_date:"",lable:"Posting Date",isDisable:!0})}),s.jsx("div",{className:"mb-3 col-6",children:s.jsx(T,{id:"due_date",value:m?m.due_date:"",lable:"Due Date",isDisable:!0})}),s.jsxs("div",{className:"col-12",children:[s.jsx(ye,{htmlFor:"recourse",children:"Assignment Details"}),s.jsx("iframe",{src:m?m.recourse:"",width:"100%",height:"500",title:"Assignment",id:"recourse"})]})]})]})})})})};export{Pe as default};
