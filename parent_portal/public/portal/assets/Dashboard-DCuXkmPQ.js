var B=(s,m,a)=>new Promise((p,d)=>{var h=c=>{try{o(a.next(c))}catch(u){d(u)}},i=c=>{try{o(a.throw(c))}catch(u){d(u)}},o=c=>c.done?p(c.value):Promise.resolve(c.value).then(h,i);o((a=a.apply(s,m)).next())});import{r as l,_ as D,t as g,a as v,c as k,P as n,b as _,j as e,C,d as N,e as F,f as L,g as W,h as Z,i as O,k as I}from"./index-_3kuEyIw.js";import{h as j}from"./moment-DFa0WlA5.js";var P=l.forwardRef(function(s,m){var a,p=s.children,d=s.className,h=s.size,i=s.vertical,o=D(s,["children","className","size","vertical"]);return g.createElement("div",v({className:k(i?"btn-group-vertical":"btn-group",(a={},a["btn-group-".concat(h)]=h,a),d)},o,{ref:m}),p)});P.propTypes={children:n.node,className:n.string,size:n.oneOf(["sm","lg"]),vertical:n.bool};P.displayName="CButtonGroup";var M=l.createContext({}),R=l.forwardRef(function(s,m){var a=s.children,p=s.className,d=D(s,["children","className"]);return g.createElement("div",v({className:k("progress-stacked",p),ref:m},d),g.createElement(M.Provider,{value:{stacked:!0}},a))});R.propTypes={children:n.node,className:n.string};R.displayName="CProgressStacked";var E=l.forwardRef(function(s,m){var a,p=s.children,d=s.animated,h=s.className,i=s.color,o=s.value,c=o===void 0?0:o,u=s.variant,f=D(s,["children","animated","className","color","value","variant"]),x=l.useContext(M).stacked;return g.createElement("div",v({className:k("progress-bar",(a={},a["bg-".concat(i)]=i,a["progress-bar-".concat(u)]=u,a["progress-bar-animated"]=d,a),h)},!x&&{style:{width:"".concat(c,"%")}},f,{ref:m}),p)});E.propTypes={animated:n.bool,children:n.node,className:n.string,color:_,value:n.number,variant:n.oneOf(["striped"])};E.displayName="CProgressBar";var w=l.forwardRef(function(s,m){var a=s.children,p=s.className,d=s.height,h=s.progressBarClassName,i=s.thin,o=s.value,c=s.white,u=D(s,["children","className","height","progressBarClassName","thin","value","white"]),f=l.useContext(M).stacked;return g.createElement("div",v({className:k("progress",{"progress-thin":i,"progress-white":c},p)},o!==void 0&&{role:"progressbar","aria-valuenow":o,"aria-valuemin":0,"aria-valuemax":100},{style:v(v({},d?{height:"".concat(d,"px")}:{}),f?{width:"".concat(o,"%")}:{}),ref:m}),g.Children.toArray(a).some(function(x){return x.type&&x.type.displayName==="CProgressBar"})?g.Children.map(a,function(x){if(g.isValidElement(x)&&x.type.displayName==="CProgressBar")return g.cloneElement(x,v(v({},o&&{value:o}),u))}):g.createElement(E,v({},h&&{className:h},{value:o},u),a))});w.propTypes={children:n.node,className:n.string,height:n.number,progressBarClassName:n.string,thin:n.bool,value:n.number,white:n.bool};w.displayName="CProgress";var U=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M411.6,343.656l-72.823-47.334,27.455-50.334A80.23,80.23,0,0,0,376,207.681V128a112,112,0,0,0-224,0v79.681a80.236,80.236,0,0,0,9.768,38.308l27.455,50.333L116.4,343.656A79.725,79.725,0,0,0,80,410.732V496H448V410.732A79.727,79.727,0,0,0,411.6,343.656ZM416,464H112V410.732a47.836,47.836,0,0,1,21.841-40.246l97.66-63.479-41.64-76.341A48.146,48.146,0,0,1,184,207.681V128a80,80,0,0,1,160,0v79.681a48.146,48.146,0,0,1-5.861,22.985L296.5,307.007l97.662,63.479h0A47.836,47.836,0,0,1,416,410.732Z' class='ci-primary'/>"];const K=()=>{const[s,m]=l.useState([]),[a,p]=l.useState({present:0,absent:0}),[d,h]=l.useState([]),[i,o]=l.useState(null),[c,u]=l.useState("Month"),[f,x]=l.useState({startDate:j().startOf("month"),endDate:j().endOf("month")}),T=r=>{u(r);const t=j(),y={Day:[t.startOf("day").format(),t.endOf("day").format()],Week:[t.startOf("week").format(),t.endOf("week").format()],Month:[t.startOf("month").format(),t.endOf("month").format()],Year:[t.startOf("year").format(),t.endOf("year").format()]},[b,S]=y[r]||y.Month;x({startDate:b,endDate:S})},A=(r,t)=>B(void 0,null,function*(){const y=d[i]||{};try{const b=yield O.get("/api/method/parent_portal.parent_portal.api.get_attendance_summary",{params:{start_date:r,end_date:t,student:y.name}}),{summary:S,total_present:G,total_absent:H}=b.data.message;m(S),p({present:G,absent:H})}catch(b){console.error("Failed to fetch attendance summary:",b)}}),V=()=>B(void 0,null,function*(){try{const r=yield O.get("/api/method/parent_portal.parent_portal.api.get_student_details");h(r.data.message)}catch(r){console.error("Failed to fetch students:",r)}});l.useEffect(()=>{V()},[]),l.useEffect(()=>{A(f.startDate.toString(),f.endDate.toString())},[f,i]);const Y=()=>e.jsxs("div",{className:"mb-2",children:[c==="Day"&&e.jsx("div",{className:"small text-body-secondary",children:"Today"}),c!=="Day"&&e.jsxs("div",{className:"small text-body-secondary",children:[j(f.startDate).format("DD MMMM")," -"," ",j(f.endDate).format("DD MMMM YYYY")]})]}),z=({student:r,index:t})=>e.jsx("div",{className:`progress-group mb-2 p-2 rounded ${i===t?"selected":""}`,onClick:()=>o(y=>y===t?null:t),style:{cursor:"pointer",backgroundColor:i===t?"#f0f8ff":"transparent"},children:e.jsxs("div",{className:"progress-group-header d-flex align-items-center",children:[e.jsx(I,{className:"me-2",icon:U,size:"lg"}),e.jsx("span",{children:r.first_name}),e.jsx("span",{className:"ms-auto fw-semibold",children:r.admission_registration_id})]})});return e.jsx(C,{className:"mx-4",children:e.jsx(N,{xs:!0,children:e.jsxs(F,{className:"mb-4",children:[e.jsx(L,{children:"Attendance"}),e.jsx(W,{children:e.jsxs(C,{children:[e.jsxs(N,{xs:12,md:6,xl:6,children:[e.jsxs(C,{children:[e.jsx(N,{xs:6,children:e.jsxs("div",{className:"border-start border-start-4 border-start-success py-1 px-3",children:[e.jsx("div",{className:"text-body-secondary text-truncate small",children:"Total Present"}),e.jsx("div",{className:"fs-5 fw-semibold",children:a.present})]})}),e.jsx(N,{xs:6,children:e.jsxs("div",{className:"border-start border-start-4 border-start-danger py-1 px-3 mb-3",children:[e.jsx("div",{className:"text-body-secondary text-truncate small",children:"Total Absent"}),e.jsx("div",{className:"fs-5 fw-semibold",children:a.absent})]})})]}),e.jsx("hr",{className:"mt-0"}),s.map((r,t)=>e.jsxs("div",{className:"progress-group mb-4",children:[e.jsx("div",{className:"progress-group-prepend",children:e.jsx("span",{className:"text-body-secondary small",children:r.title})}),e.jsxs("div",{className:"progress-group-bars",children:[e.jsx(w,{thin:!0,color:"success",value:r.present}),e.jsx(w,{thin:!0,color:"danger",value:r.absent})]})]},t))]}),e.jsxs(N,{xs:12,md:6,xl:6,children:[e.jsxs(C,{children:[e.jsx(N,{xs:6}),e.jsxs(N,{xs:6,children:[e.jsx(P,{className:"float-end me-3 mb-2",children:["Day","Week","Month","Year"].map(r=>e.jsx(Z,{color:"outline-secondary",className:"mx-0",active:r===c,onClick:()=>T(r),children:r},r))}),e.jsx(Y,{})]})]}),e.jsx("hr",{className:"mt-0"}),e.jsx("div",{style:{height:"340px",overflow:"auto"},children:d.map((r,t)=>e.jsx(z,{student:r,index:t},t))})]})]})})]})})})};export{K as default};
